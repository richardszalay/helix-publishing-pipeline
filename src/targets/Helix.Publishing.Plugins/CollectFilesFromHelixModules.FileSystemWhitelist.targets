<Project>
  <!-- File System (Whitelist) implementation of CollectFilesFromHelixModules -->
  <Target Name="CollectFilesFromHelixModulesFileSystemWhitelist">
    <!-- TODO: Figure out how to do this dynamically from an item list of wildcard matches -->
    <PropertyGroup>
        <_HelixModuleContentPath>$(HelixModuleWebContentDirectory)</_HelixModuleContentPath>
        <HelixModuleContentInclude>$(HelixModuleContentInclude);@(HelixModulePaths -> '%(RootDir)%(Directory)$(_HelixModuleContentPath)\App_Config\**\*')</HelixModuleContentInclude>
        <HelixModuleContentInclude>$(HelixModuleContentInclude);@(HelixModulePaths -> '%(RootDir)%(Directory)$(_HelixModuleContentPath)\**\*.cshtml')</HelixModuleContentInclude>
        <HelixModuleContentInclude>$(HelixModuleContentInclude);@(HelixModulePaths -> '%(RootDir)%(Directory)$(_HelixModuleContentPath)\**\*.vbhtml')</HelixModuleContentInclude>
        <HelixModuleContentInclude>$(HelixModuleContentInclude);@(HelixModulePaths -> '%(RootDir)%(Directory)$(_HelixModuleContentPath)\**\*.css')</HelixModuleContentInclude>
        <HelixModuleContentInclude>$(HelixModuleContentInclude);@(HelixModulePaths -> '%(RootDir)%(Directory)$(_HelixModuleContentPath)\**\*.js')</HelixModuleContentInclude>
        <HelixModuleContentInclude>$(HelixModuleContentInclude);@(HelixModulePaths -> '%(RootDir)%(Directory)$(_HelixModuleContentPath)\**\*.svg')</HelixModuleContentInclude>
        <HelixModuleContentInclude>$(HelixModuleContentInclude);@(HelixModulePaths -> '%(RootDir)%(Directory)$(_HelixModuleContentPath)\**\*.png')</HelixModuleContentInclude>
        <HelixModuleContentInclude>$(HelixModuleContentInclude);@(HelixModulePaths -> '%(RootDir)%(Directory)$(_HelixModuleContentPath)\**\*.jpg')</HelixModuleContentInclude>
        <HelixModuleContentInclude>$(HelixModuleContentInclude);@(HelixModulePaths -> '%(RootDir)%(Directory)$(_HelixModuleContentPath)\**\*.jpeg')</HelixModuleContentInclude>
    </PropertyGroup>

    <ItemGroup>
        <_HelixModuleContentSpecs Include="@(HelixModulePaths -> '%(RootDir)%(Directory)\**\*')">
            <HelixModulePath>%(RootDir)%(Directory)</HelixModulePath>
        </_HelixModuleContentSpecs>
    </ItemGroup>

    <CreateItem Include="@(_HelixModuleContentSpecs)" PreserveExistingMetadata="true">
        <Output TaskParameter="Include" ItemName="_HelixModuleContent"/>
    </CreateItem>

    <ItemGroup>
        <_HelixModuleExcludedContent Include="@(_HelixModuleContent)" Exclude="$(HelixModuleContentInclude)" />
        <_HelixModuleIncludedContent Include="@(_HelixModuleContent)" Exclude="@(_HelixModuleExcludedContent)" />

        <FilesForPackagingFromHelixModules Include="@(_HelixModuleIncludedContent)">
            <DestinationRelativePath>$([MSBuild]::MakeRelative('%(_HelixModuleIncludedContent.HelixModulePath)', '%(FullPath)'))</DestinationRelativePath>
            <FromTarget>CollectFilesFromHelixModuleContent</FromTarget>
        </FilesForPackagingFromHelixModules>
    </ItemGroup>
  </Target>
</Project>